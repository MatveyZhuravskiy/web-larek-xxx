# Web Larek - Интернет-магазин цифровых товаров

## Описание проекта

Web Larek - это одностраничное приложение (SPA) интернет-магазина цифровых товаров, построенное на TypeScript с использованием архитектурного паттерна **MVP (Model-View-Presenter)** и событийно-ориентированной архитектуры для обеспечения слабой связанности компонентов.

## Инструкция по запуску

### Установка зависимостей

```bash
npm install
```

### Запуск в режиме разработки

```bash
npm run start
```
Приложение будет доступно по адресу: `http://localhost:8080`

### Сборка для production

```bash
npm run build
```

### Дополнительные команды

```bash
npm run lint          # Проверка кода линтером
npm run lint:fix      # Автоматическое исправление ошибок
npm run format        # Форматирование кода Prettier
npm run deploy        # Деплой на GitHub Pages
```

## Архитектура проекта

Проект использует архитектурный паттерн **MVP (Model-View-Presenter)** с элементами **Event-Driven Architecture**.

### Структура проекта
```
src/
├── components/
│   ├── base/            # Базовые компоненты (API, EventEmitter)
│   ├── model/           # Модели данных (Model слой)
│   └── view/            # Представления (View слой)
├── types/               # TypeScript типы и интерфейсы
├── utils/               # Вспомогательные утилиты
├── scss/                # Стили приложения
└── index.ts             # Presenter слой (главная логика приложения)
```

## Детальное описание компонентов

### Базовые компоненты

#### 1. Класс `Api` (`components/base/api.ts`)
**Назначение:** Универсальный HTTP-клиент для взаимодействия с backend API.

**Поля:**
- `baseUrl` - хранит базовый адрес API сервера для формирования полных URL запросов
- `options` - содержит настройки HTTP-запросов (заголовки, методы аутентификации и другие параметры)

**Методы:**
- `constructor()` - создает экземпляр API клиента с указанным базовым URL и настройками
- `get()` - выполняет GET-запрос к указанному эндпоинту и возвращает данные в виде Promise
- `post()` - отправляет данные на сервер с помощью POST, PUT или DELETE запроса
- `handleResponse()` - обрабатывает ответ от сервера, проверяет статус и преобразует в нужный формат

#### 2. Класс `ApiClient` (`components/base/apiClient.ts`)
**Назначение:** Специализированный клиент для работы с API магазина.

**Наследует:** `Api`

**Поля:**
- `cdn` - хранит базовый URL для загрузки изображений товаров из CDN

**Методы:**
- `fetchProducts()` - загружает полный список товаров из каталога магазина
- `fetchProduct()` - получает детальную информацию о конкретном товаре по его идентификатору
- `createOrder()` - отправляет данные заказа на сервер и получает подтверждение с номером заказа

#### 3. Класс `EventEmitter` (`components/base/events.ts`)
**Назначение:** Реализация паттерна Наблюдатель для управления событиями.

**Поля:**
- `_events` - внутренняя карта, которая связывает названия событий с наборами функций-подписчиков

**Методы:**
- `on()` - регистрирует функцию-обработчик для указанного события
- `off()` - удаляет конкретный обработчик из списка подписчиков события
- `emit()` - запускает все обработчики указанного события, передавая им данные
- `onAll()` - устанавливает универсальный обработчик, который будет вызываться для всех событий
- `offAll()` - удаляет все обработчики всех событий, очищая систему событий

### Слой модели (Model Layer)

#### 1. Класс `CommonModel<T>` (`model/CommonModel.ts`)
**Назначение:** Базовый класс для всех моделей.

**Поля:**
- `events` - ссылка на систему событий для уведомления других компонентов об изменениях

**Методы:**
- `constructor()` - создает модель с начальными данными и подключает к системе событий
- `emitChanges()` - отправляет уведомление о том, что данные модели изменились

#### 2. Класс `CatalogModel` (`model/CatalogModel.ts`)
**Назначение:** Управление данными каталога товаров.

**Наследует:** `CommonModel<IProductList>`

**Поля:**
- `_items` - внутренний массив, хранящий все товары каталога

**Методы:**
- `set items()` - обновляет список товаров в каталоге и уведомляет об изменениях
- `get items()` - возвращает текущий список всех товаров в каталоге
- `getId()` - находит и возвращает товар по его уникальному идентификатору

#### 3. Класс `BasketModel` (`model/BasketModel.ts`)
**Назначение:** Управление состоянием корзины покупок.

**Наследует:** `CommonModel<IProductList>`

**Поля:**
- `_items` - массив товаров, добавленных пользователем в корзину

**Методы:**
- `add()` - добавляет новый товар в корзину и уведомляет об изменении
- `remove()` - удаляет товар из корзины по его идентификатору
- `clear()` - полностью очищает корзину от всех товаров
- `get total()` - вычисляет и возвращает общую стоимость всех товаров в корзине
- `get length()` - возвращает количество товаров в корзине
- `check()` - проверяет, есть ли указанный товар в корзине
- `getIdList()` - возвращает массив идентификаторов всех товаров в корзине

#### 4. Класс `OrderModel` (`model/OrderModel.ts`)
**Назначение:** Управление данными заказа.

**Наследует:** `CommonModel<IOrder>`

**Поля:**
- `_payment` - выбранный покупателем способ оплаты (карта или наличные)
- `_address` - адрес доставки, указанный покупателем
- `_email` - электронная почта покупателя для связи
- `_phone` - номер телефона покупателя
- `_total` - общая стоимость заказа
- `_items` - список идентификаторов товаров, включенных в заказ

**Методы:**
- `setDelivery()` - сохраняет информацию о способе оплаты и адресе доставки
- `setContacts()` - сохраняет контактную информацию покупателя
- `setOrderItems()` - устанавливает список товаров и общую сумму заказа
- `readyОrder()` - формирует и возвращает полный объект заказа для отправки на сервер

### Слой представления (View Layer)

#### 1. Класс `CommonView<T>` (`view/CommonView.ts`)
**Назначение:** Базовый класс для всех представлений.

**Поля:**
- `container` - основной DOM-элемент, который содержит весь интерфейс компонента

**Методы:**
- `setImage()` - устанавливает изображение в указанный элемент с заданным источником и альтернативным текстом
- `setText()` - устанавливает текстовое содержимое в DOM-элемент
- `setDisabled()` - включает или отключает интерактивность элемента
- `toggleClass()` - добавляет или удаляет CSS-класс у элемента
- `render()` - создает и возвращает готовый DOM-элемент компонента с данными

#### 2. Класс `CardView<T>` (`view/CardView.ts`)
**Назначение:** Базовое представление карточки товара.

**Наследует:** `CommonView<T>`

**Поля:**
- `_title` - DOM-элемент для отображения названия товара
- `_price` - DOM-элемент для отображения цены товара
- `id` - уникальный идентификатор товара для связи с данными

**Методы:**
- `set title()` - обновляет отображаемое название товара в карточке
- `set price()` - обновляет отображаемую цену товара в карточке

#### 3. Класс `CatalogView<T>` (`view/CatalogView.ts`)
**Назначение:** Представление карточки товара в каталоге.

**Наследует:** `CardView<T>`

**Дополнительные поля:**
- `_category` - DOM-элемент для отображения категории товара
- `_image` - DOM-элемент для отображения изображения товара

**Дополнительные методы:**
- `set image()` - устанавливает изображение товара из указанного источника
- `set category()` - устанавливает и отображает категорию товара
- `toggleCategoryClass()` - применяет специальный CSS-стиль в зависимости от категории товара

#### 4. Класс `ProductView` (`view/ProductView.ts`)
**Назначение:** Расширенное представление товара для превью.

**Наследует:** `CatalogView<ProductPreviewData>`

**Дополнительные поля:**
- `button` - кнопка для добавления товара в корзину или других действий
- `_description` - DOM-элемент для отображения подробного описания товара

**Дополнительные методы:**
- `set description()` - устанавливает подробное описание товара
- `set valid()` - включает или отключает кнопку в зависимости от возможности покупки
- `set state()` - управляет внешним видом товара (доступен/недоступен)

#### 5. Класс `BasketView` (`view/BasketView.ts`)
**Назначение:** Представление корзины покупок.

**Наследует:** `CommonView<IBasketView>`

**Поля:**
- `button` - кнопка для перехода к оформлению заказа
- `_list` - контейнер для отображения списка товаров в корзине
- `_price` - DOM-элемент для отображения общей стоимости товаров

**Методы:**
- `set price()` - обновляет отображение общей суммы корзины
- `set valid()` - включает или отключает кнопку оформления заказа
- `set list()` - обновляет список отображаемых товаров в корзине

#### 6. Класс `BasketCardView` (`view/BasketView.ts`)
**Назначение:** Представление товара в корзине.

**Наследует:** `CardView<BasketProductCard>`

**Дополнительные поля:**
- `button` - кнопка для удаления товара из корзины
- `_index` - DOM-элемент для отображения порядкового номера товара в списке

**Дополнительные методы:**
- `set index()` - устанавливает и отображает порядковый номер товара в корзине

#### 7. Класс `ModalView` (`view/ModalView.ts`)
**Назначение:** Управление модальными окнами.

**Наследует:** `CommonView<IModalView>`

**Поля:**
- `_content` - контейнер для размещения содержимого модального окна
- `_closeButton` - кнопка для закрытия модального окна

**Методы:**
- `set content()` - помещает указанный компонент внутрь модального окна
- `open()` - показывает модальное окно пользователю
- `close()` - скрывает модальное окно и очищает его содержимое

#### 8. Класс `FormView<T>` (`view/FormView.ts`)
**Назначение:** Базовый класс для форм.

**Наследует:** `CommonView<IFormValidation>`

**Поля:**
- `_submit` - кнопка для отправки формы
- `_errors` - DOM-элемент для отображения сообщений об ошибках валидации

**Методы:**
- `set valid()` - включает или отключает кнопку отправки в зависимости от валидности формы
- `set errors()` - отображает пользователю сообщения об ошибках заполнения
- `clear()` - очищает все поля формы и сбрасывает состояние

#### 9. Класс `OrderView` (`view/OrderView.ts`)
**Назначение:** Представление формы заказа (доставка).

**Наследует:** `FormView<IDeliveryInfo>`

**Дополнительные поля:**
- `_card` - кнопка для выбора оплаты банковской картой
- `_cash` - кнопка для выбора оплаты наличными при получении
- `_address` - поле ввода для указания адреса доставки

**Дополнительные методы:**
- `set payment()` - выделяет выбранный способ оплаты в интерфейсе
- `set address()` - устанавливает значение в поле адреса доставки
- `get payment()` - возвращает выбранный пользователем способ оплаты
- `get address()` - возвращает введенный пользователем адрес доставки

#### 10. Класс `ContactsView` (`view/ContactsView.ts`)
**Назначение:** Представление формы контактов.

**Наследует:** `FormView<IContactInfo>`

**Дополнительные поля:**
- `_phone` - поле ввода для указания номера телефона покупателя
- `_email` - поле ввода для указания электронной почты покупателя

**Дополнительные методы:**
- `set phone()` - устанавливает значение в поле ввода телефона
- `set email()` - устанавливает значение в поле ввода электронной почты
- `get phone()` - возвращает введенный пользователем номер телефона
- `get email()` - возвращает введенный пользователем адрес электронной почты

#### 11. Класс `SuccessView` (`view/SuccessView.ts`)
**Назначение:** Представление экрана успешного заказа.

**Наследует:** `CommonView<ISuccessView>`

**Поля:**
- `description` - DOM-элемент для отображения информации об успешном заказе
- `button` - кнопка для закрытия окна успешного заказа

**Методы:**
- `set total()` - отображает итоговую сумму успешно оформленного заказа

#### 12. Класс `Page` (`view/Page.ts`)
**Назначение:** Управление основными элементами страницы.

**Наследует:** `CommonView<IPageView>`

**Поля:**
- `_counter` - DOM-элемент для отображения количества товаров в корзине
- `_basketButton` - кнопка для открытия корзины покупок
- `_catalog` - контейнер для размещения карточек товаров каталога
- `_wrapper` - основная обертка страницы для управления блокировкой

**Методы:**
- `set catalog()` - размещает переданные карточки товаров в контейнере каталога
- `set counter()` - обновляет отображаемое количество товаров в корзине
- `lock()` - блокирует или разблокирует взаимодействие со страницей

### Вспомогательные утилиты (`utils/utils.ts`)

**Методы:**
- `ensureElement()` - находит DOM-элемент по селектору и гарантирует его существование, иначе выбрасывает ошибку
- `cloneTemplate()` - создает копию HTML-шаблона по его идентификатору для использования в компонентах

### Константы (`utils/constants.ts`)

**Поля:**
- `CDN_URL` - содержит базовый адрес сервера для загрузки изображений товаров
- `API_URL` - содержит базовый адрес API сервера для выполнения HTTP-запросов

## Типы данных (`types/index.ts`)

### Базовые сущности
```typescript
interface IProduct {
  id: string
  title: string
  price: number
  description: string
  category: string
  image: string
}

interface IProductList {
  items: IProduct[]
}

type ProductId = Pick<IProduct, 'id'>

type ProductCard = Omit<IProduct, 'description'>

type ProductPreviewData = IProduct & {
  valid: boolean
  state: boolean
}

type BasketProductCard = Omit<IProduct, 'description' | 'category' | 'image'> & {
  index: number
}
```

### Данные форм
```typescript
interface IDeliveryInfo {
  payment: PaymentMethod
  address: string
}

interface IContactInfo {
  email: string
  phone: string
}

interface IOrderItems {
  total: number
  items: string[]
}

type IOrderRequest = IDeliveryInfo & IContactInfo & IOrderItems

interface IOrder extends IOrderRequest {
  readyОrder(): IOrderRequest
  setDelivery(delivery: IDeliveryInfo): void
  setContacts(contacts: IContactInfo): void
  setOrderItems(orderItems: IOrderItems): void
}

interface IOrderResponse {
  id: string
  total: number
}

type PaymentMethod = 'card' | 'cash'
```

### События приложения
```typescript
enum AppEvents {
  // Каталог и товары
  CATALOG_CHANGED = 'catalog:items-changed',
  PRODUCT_SELECT = 'card:select',
  
  // Корзина
  BASKET_OPEN = 'basket:open',
  BASKET_ADD_ITEM = 'basket:add',
  BASKET_REMOVE_ITEM = 'basket:remove',
  BASKET_CHANGED = 'basket:items-changed',
  
  // Оформление заказа
  ORDER_START = 'order:open',
  ORDER_DELIVERY_INPUT = 'order:input',
  ORDER_DELIVERY_SUBMIT = 'order:submit',
  ORDER_DELIVERY_CHANGED = 'order:delivery-changed',
  ORDER_CONTACTS_INPUT = 'contacts:input',
  ORDER_CONTACTS_SUBMIT = 'contacts:submit',
  ORDER_CONTACTS_CHANGED = 'order:contacts-changed',
  ORDER_ITEMS_CHANGED = 'order:items-changed',
  
  // Завершение заказа
  ORDER_SUCCESS_CLOSE = 'success:submit',
  
  // Модальные окна
  MODAL_OPEN = 'modal:open',
  MODAL_CLOSE = 'modal:close',
}
```

### Интерфейсы представлений
```typescript
interface IPageView {
  catalog: HTMLElement[]
  counter: number
}

interface IModalView {
  content: HTMLElement
}

interface IBasketView {
  list: HTMLElement[]
  valid: boolean
  price: number
}

interface IFormValidation {
  valid: boolean
}

interface IForm extends IFormValidation {
  render(data?: IFormValidation): HTMLElement
}

interface ISuccessView {
  total: number
}
```

### API интерфейсы
```typescript
interface IApiClient {
  fetchProducts(): Promise<IProduct[]>
  fetchProduct(id: string): Promise<IProduct>
  createOrder(order: IOrderRequest): Promise<IOrderResponse>
}

interface ApiListResponse<Type> {
  total: number
  items: Type[]
}

type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'
```

## Взаимодействие компонентов

### Архитектура MVP

```
┌─────────────────┐    События    ┌──────────────────┐    Данные    ┌─────────────────┐
│                 │ ──────────────→│                  │ ────────────→│                 │
│  View Layer     │                │  Presenter       │              │  Model Layer    │
│  (Представления)│                │  (index.ts)      │              │  (Модели)       │
│                 │←─────────────── │                  │←─────────────│                 │
└─────────────────┘   DOM Updates  └──────────────────┘   События    └─────────────────┘
         ↑                                   ↓
         │                                   │
         └────────── DOM События ────────────┘
```

### Принципы взаимодействия

1. **Model слой** содержит только данные и бизнес-логику
2. **View слой** работает только с DOM-элементами и пользовательским интерфейсом
3. **Presenter** (index.ts) координирует взаимодействие через EventEmitter
4. Все слои взаимодействуют только через события (слабая связанность)
5. Модели генерируют события при изменении данных
6. Представления генерируют события при пользовательских действиях

### Последовательность работы

1. **Инициализация:**
   - Presenter создает `EventEmitter`, `ApiClient`, все модели и представления
   - Загружает товары через `ApiClient.fetchProducts()`
   - Сохраняет данные в `CatalogModel`
   - Генерирует событие `AppEvents.CATALOG_CHANGED`
   - Обновляет каталог на странице

2. **Выбор товара:**
   - Пользователь кликает на карточку товара
   - `CatalogView` генерирует событие `AppEvents.PRODUCT_SELECT`
   - Presenter обрабатывает событие, получает данные товара из `CatalogModel`
   - Открывает модальное окно с `ProductView`

3. **Добавление в корзину:**
   - Пользователь кликает "В корзину" в `ProductView`
   - Генерируется событие `AppEvents.BASKET_ADD_ITEM`
   - Presenter вызывает `BasketModel.add()`
   - `BasketModel` обновляет состояние и генерирует `AppEvents.BASKET_CHANGED`
   - Обновляется счетчик корзины на странице

4. **Оформление заказа:**
   - Пользователь открывает корзину (`AppEvents.BASKET_OPEN`)
   - Заполняет `OrderView` (данные доставки)
   - Заполняет `ContactsView` (контактные данные)
   - Формы валидируют данные и генерируют события
   - Presenter собирает данные через `OrderModel`
   - Отправляет заказ через `ApiClient.createOrder()`
   - Показывает `SuccessView` с результатом

## Принципы разработки

### Соблюденные принципы SOLID
- **Single Responsibility:** Каждый класс имеет одну четкую ответственность
- **Open/Closed:** Компоненты открыты для расширения, закрыты для модификации  
- **Liskov Substitution:** Наследуемые классы могут заменять базовые
- **Interface Segregation:** Интерфейсы разделены по функциональности
- **Dependency Inversion:** Высокоуровневые модули не зависят от низкоуровневых

### Архитектурные принципы MVP
- **Разделение ответственности:** Model, View, Presenter имеют четкие границы
- **Слабая связанность:** Взаимодействие только через события
- **Отсутствие DOM в моделях:** Модели работают только с данными
- **Отсутствие бизнес-логики в представлениях:** View только отображает данные

### Паттерны проектирования
- **MVP:** Основной архитектурный паттерн проекта
- **Observer:** Реализован через `EventEmitter` для событийной архитектуры
- **Template Method:** Базовые классы определяют общую структуру
- **Strategy:** Различные представления для разных контекстов

### Преимущества архитектуры
- **Тестируемость:** Каждый слой можно тестировать независимо
- **Масштабируемость:** Легко добавлять новые компоненты
- **Поддерживаемость:** Изменения в одном слое не влияют на другие
- **Переиспользуемость:** Компоненты можно использовать в других проектах
- **Читаемость:** Четкая структура и разделение ответственности

---

**Технический стек:** TypeScript, Webpack 5, SCSS, ESLint, Prettier  
**Архитектура:** MVP (Model-View-Presenter) + Event-Driven Architecture  
**Подход:** Слоевая архитектура со строгим разделением ответственности
**Размещение в сети:** [GitHub Repository](https://github.com/AntonZhuravskiy/web-larek-frontend.git)